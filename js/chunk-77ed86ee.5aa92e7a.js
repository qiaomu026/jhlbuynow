(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-77ed86ee"],{5206:function(t,e,s){"use strict";var o=s("d0fa"),i=s.n(o);i.a},d0fa:function(t,e,s){},ebce:function(t,e,s){"use strict";s("28a5"),s("4917"),s("a481");var o=s("2241"),i=s("5863"),a=s("2f62"),n=s("e036"),r=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("van-count-down",{attrs:{time:t.timeBox},on:{finish:t.countDownFinish},scopedSlots:t._u([{key:"default",fn:function(e){return[s("span",{staticClass:"item",style:{background:"#C97D00"}},[t._v(t._s(e.hours))]),s("span",{style:{color:"#FFFFFF"}},[t._v(":")]),s("span",{staticClass:"item",style:{background:"#C97D00"}},[t._v(t._s(e.minutes))]),s("span",{style:{color:"#FFFFFF"}},[t._v(":")]),s("span",{staticClass:"item",style:{background:"#C97D00"}},[t._v(t._s(e.seconds))])]}}])})],1)},l=[],h={name:"detailCountdown",props:["timeBox"],data:{returun:{interValTime:null}},methods:{countDownFinish:function(){console.log("走到了这里！！"),this.$parent.flashSaleDetail()}},mounted:function(){var t=this,e=this.timeBox;this.interValTime=setInterval((function(){e-=1e3,3e5==e&&t.countDownFinish()}),1e3)},destroyed:function(){clearInterval(this.interValTime)}},c=h,u=(s("5206"),s("2877")),d=Object(u["a"])(c,r,l,!1,null,"5836e6e2",null),f=d.exports,p=s("5d2d");s.d(e,"a",(function(){return m}));var m={name:"flashSaleGoods",data:function(){return{lists:{spuPicUrlList:[]},flashSaleData:{},shopInfo:{},skuList:[],skuNum:[],collectCode:[],cutOffTimeStr:[],goodsNum:0,icon:{collection:s("6a9a"),afterCollectionBg:s("4e2e"),collectionBg:s("ebdc"),afterCollection:s("844d"),shoppingCartBg:s("fedd"),shoppingCart:s("1094"),arrowBg:s("f295"),arrow:s("8d7d"),share:s("f6a1"),topClick:s("f21d"),callShop:s("f707"),shop:s("9335"),evaluate:s("d3b8"),like:s("b9b4"),noLike:s("4783"),defaultXWJPic:s("8eda"),noNetworkImg:s("6508"),shareChart:s("9430"),shareFriends:s("016c")},show:{normalTitle:!0,activeTitle:!1,titShow:0,weChartShare:!1,callShop:!1,firstEvaluate:!0,showDialog:!1,goodsDown:!1,saleOut:!1,remindSale:!1,bannerChangeBool:!1,networkError:!0,afterCollect:!1,beforeCollect:!0},evalInfo:[],num:1,detailDescribe:[],ownerPicUrl:s("cf9f"),time:1e3,activitySpuId:this.$route.query.activitySpuId,status:-1,remind:"开抢时提醒我",isShowTopBtn:!1,setTopHeight:{"padding-top":this.$stbHeight+"px"},images:[],productImgs:[],hasStoragePermission:!1,isShowPreview:!1,isShowPlaceHolder:!1}},components:{Preview:n["a"],detailCountDown:f},methods:{goTopBtn:function(){this.$refs.goodsPageScroll.scrollTop=0},bannerChange:function(){var t=this;this.show.bannerChangeBool=!0,setTimeout((function(){t.show.bannerChangeBool=!1}),500)},productImgDownload:function(){var t=0,e=this;this.lists.spuPicUrlList.map((function(s,o){var i=new Image;i.onload=function(){t+=1,console.log("商品详情图片"+t),console.log(e.lists.spuPicUrlList.length+"==========="+t),e.lists.spuPicUrlList.length==t&&(console.log("==========="+t),e.productImgs=e.lists.spuPicUrlList)},i.src=e.lists.spuPicUrlList[o]}))},bannerPreview:function(t,e){var s=this;this.show.bannerChangeBool||(this.images=t,this.isShowPreview=!0,this.$nextTick((function(){s.$refs.myPreview.setIndex(e),s.$refs.myPreview.setIsShowPreview(!0),s.$store.dispatch("setPreviewId",s.$refs.myPreview)})))},preview:function(t,e){var s=this,o=[];t.map((function(t){o.push(t.picUrl)})),this.images=o,this.isShowPreview=!0,this.$nextTick((function(){s.$refs.myPreview.setIndex(e),s.$refs.myPreview.setIsShowPreview(!0),s.$store.dispatch("setPreviewId",s.$refs.myPreview)}))},init:function(){var t=this,e={spuCode:this.spuCode};Object(i["l"])(e).then((function(e){if("0"==e.resultCode){t.lists=e.data,t.lists.cutOffTimeStr&&t.lists.cutOffTimeStr.indexOf("<br/>")&&(t.lists.cutOffTimeStr=t.lists.cutOffTimeStr.replace(/<br\/>/g,"\n")),t.productImgDownload(),t.show.networkError=!1,t.skuList=e.data.skuList[0],t.evalInfo=e.data.evalInfo;var s=e.data.evalInfo;null==s?t.show.firstEvaluate=!1:(console.log("有第一条评价"),t.show.firstEvaluate=!0),t.getShopInfo(t.lists.shopCode)}else o["a"].alert({message:e.msg}).then((function(){t.$router.go(-1)}))}))},getShopInfo:function(t){var e=this;console.log("店铺详情==========>");var s={shopCode:t};Object(i["m"])(s).then((function(t){e.shopInfo=t.data}))},flashSaleDetail:function(){var t=this,e={activitySpuId:this.activitySpuId,ownerCode:this.$userInfo.OWNER_CODE};Object(i["i"])(e).then((function(e){console.log("提醒业主"+JSON.stringify(e)),t.status=e.data.spuStatus,t.flashSaleData=e.data,0==t.status?(t.flashSaleData.time=1e3*(e.data.startTime-e.data.nowTime),console.log("获取到的时间"+t.flashSaleData.time),t.remind=0==e.data.isSubsribe?"开抢时提醒我":"取消订阅"):(t.flashSaleData.time=1e3*(e.data.endTime-e.data.nowTime),console.log(1111111111+t.time)),console.log(1111111111+t.flashSaleData.spuSkPrice)})).catch((function(e){t.show.networkError=!0,t.$toast("网络异常，请稍后重试"),t.productImgs=[t.icon.defaultXWJPic]}))},toBuy:function(){var t=this;this.activitySpuId,this.goodsNum;if(1==this.status)if(console.log("是否绑定房间"+this.$userInfo.ROOM_CODE),this.$userInfo.ROOM_CODE){var e=[];e.push({shopName:this.lists.shopName,shopCode:this.lists.shopCode,shopTotal:this.goodsNum*this.lists.skuList[0].skuPrice,skuList:[{spuCode:this.lists.skuList.spuCode,spuName:this.lists.skuList.spuName,skuNo:this.lists.skuList[0].skuNo,attrValueContent:this.lists.skuList[0].attrValueContent,skuPrice:this.flashSaleData.skuPrice,skuCount:this.goodsNum,skuDelivery:0,skuTotal:this.goodsNum*this.lists.skuList[0].skuPrice,skuPicUrl:this.lists.skuPicUrl,activitySpuId:this.activitySpuId}]});var s={orderSource:"2",goodsList:e,num:100*Math.random()};console.log("跳转传参："+JSON.stringify(s)),this.$router.push({name:"orderPayNew",params:{goodsData:s}})}else o["a"].confirm({message:"您未绑定房间，是否前往绑定？",confirmButtonText:"前往"}).then((function(){t.$router.push("selectArea")})).catch((function(){}))},handleScroll:function(){var t=this,e=this;e.$nextTick((function(){var s=e.$refs.goodsPageScroll.scrollTop,o=e.$refs.titChange.offsetTop-60,i=e.$refs.detailChange.offsetTop-60;s>t.$stbHeight?(e.show.activeTitle=!0,e.show.normalTitle=!1,e.show.titShow=s>=i?2:s>=o?1:0,e.isShowTopBtn=!0):(e.show.activeTitle=!1,e.show.normalTitle=!0,e.isShowTopBtn=!1)}))},toShop:function(){this.ifNetworkError?this.$toast("网络异常，请稍后重试"):this.$router.push({name:"shopPage",params:{shopCode:this.lists.shopCode}})},showMoreEval:function(){console.log("商品编码"+this.lists.spuCode),this.$router.push({name:"evaluateList",params:{spuCode:this.lists.spuCode}})},goodsChange:function(){this.$refs.goodsPageScroll.scrollTop=0},titChange:function(){var t=this.$refs.titChange.offsetTop-60;this.$refs.goodsPageScroll.scrollTop=t},detailChange:function(){var t=this.$refs.detailChange.offsetTop-60;this.$refs.goodsPageScroll.scrollTop=t,this.$refs.goodsPageScroll.scrollTop!=t&&this.$toast("详情已全部展示完")},wechartShare:function(){this.show.weChartShare=!0},onCancel:function(){this.show.weChartShare=!1},shareAction:function(t){var e=this;this.hasStoragePermission?this.shareToFriend(t):o["a"].confirm({message:"请您打开存储权限，以正常使用分享功能"}).then((function(){e.requestStoragePermissions(t)})).catch((function(){}))},shareToFriend:function(t){var e=this,s={ownerCode:this.$userInfo.OWNER_CODE,areaCode:this.$userInfo.AREA_CODE,shareTo:1,activitySpuId:this.activitySpuId};Object(i["k"])(s).then((function(s){if("0"==s.resultCode){e.show.weChartShare=!1;var o=s.data;Wechat.share({message:{title:e.lists.spuName,description:null==e.lists.spuSalePoint?"更多精彩，尽在信我家":e.lists.spuSalePoint,thumb:e.lists.skuList[0].skuPicUrl,media:{type:Wechat.Type.WEBPAGE,webpageUrl:o}},scene:1==t?Wechat.Scene.SESSION:Wechat.Scene.TIMELINE},(function(){}),(function(t){e.$toast(t)}))}else e.$toast("分享失败，请稍后重试")}))},checkStoragePermissions:function(t){var e=navigator.userAgent,s=!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),o=this;if(s)this.hasStoragePermission=!0,this.shareAction(t);else{var i="android.permission.WRITE_EXTERNAL_STORAGE",a=cordova.plugins.permissions;a.checkPermission(i,(function(e){e.hasPermission?(o.hasStoragePermission=!0,o.shareAction(t)):(o.hasStoragePermission=!1,o.shareAction(t))}),(function(){o.hasStoragePermission=!1,o.shareAction(t)}))}},requestStoragePermissions:function(t){var e=navigator.userAgent,s=!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),o=this;if(s)this.hasStoragePermission=!0,this.shareAction(t);else{var i=["android.permission.WRITE_EXTERNAL_STORAGE"],a=cordova.plugins.permissions;a.requestPermissions(i,(function(e){e.hasPermission?(o.hasStoragePermission=!0,o.shareAction(t)):o.hasStoragePermission=!1}),(function(){o.hasStoragePermission=!1}))}},callShop:function(){var t=this,e=navigator.userAgent,s=!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);s?window.location.href="tel:"+this.lists.shopTel:o["a"].confirm({message:this.lists.shopTel}).then((function(){window.location.href="tel:"+t.lists.shopTel})).catch((function(){o["a"].close}))},addCollection:function(){var t=this,e={collectType:"01",contentCode:t.lists.spuCode,userCode:t.$userInfo.OWNER_CODE},s={collectCodes:[t.collectCode]};""==t.collectCode?Object(i["c"])(e).then((function(e){t.collectCode=e.data.collectCode,t.$toast("添加收藏成功"),t.show.afterCollect=!0,t.show.beforeCollect=!1})).catch((function(e){t.$toast("网络异常，请稍后重试")})):""!=t.collectCode&&Object(i["e"])(s).then((function(e){t.collectCode="",t.$toast("取消收藏成功"),t.show.afterCollect=!1,t.show.beforeCollect=!0})).catch((function(e){t.$toast("网络异常，请稍后重试")}))},ifCollection:function(){var t=this,e={collectType:"01",userCode:t.$userInfo.OWNER_CODE,contentCode:this.spuCode};Object(i["o"])(e).then((function(e){var s=e.data.list;s.length>0?(t.show.afterCollect=!0,t.show.beforeCollect=!1,t.collectCode=s[0].collectCode):(t.show.afterCollect=!1,t.show.beforeCollect=!0,t.collectCode="")}))},onClickLeft:function(){this.$router.go(-1)},goodsDown:function(){o["a"].alert({message:"该商品的秒杀已结束<br>下次再来吧",confirmButtonText:"我知道了"}).then((function(){})).catch((function(){o["a"].close}))},saleOut:function(){o["a"].alert({message:"补货中/已下架的商品<br>不可以结算哦",confirmButtonText:"我知道了"}).then((function(){}))},remindSale:function(t,e){var s=this,a={startTime:t,ownerCode:this.$userInfo.OWNER_CODE,activitySpuId:this.activitySpuId,subscribeFlag:0==this.flashSaleData.isSubsribe?"1":"0"};Object(i["p"])(a).then((function(t){"0"==t.resultCode&&0==s.flashSaleData.isSubsribe?(o["a"].alert({message:"订阅成功<br>将在开抢前提醒您",confirmButtonText:"我知道了"}).then((function(){})),s.remind="取消订阅",s.flashSaleData.isSubsribe=1):"0"==t.resultCode&&1==s.flashSaleData.isSubsribe?(s.$toast("取消订阅成功"),s.remind="开抢时提醒我",s.flashSaleData.isSubsribe=0):s.$toast("订阅失败,请稍后重试!")}))},remindBefor:function(t,e){var s=this,o={startTime:t.startTime,ownerCode:this.$userInfo.OWNER_CODE,activitySpuId:t.activitySpuId,subscribeFlag:e};Object(i["p"])(o).then((function(e){"0"==e.resultCode&&0==t.isSubsribe?(s.$toast("订阅成功"),s.onRefresh()):"0"==e.resultCode&&1==t.isSubsribe?(s.$toast("取消订阅成功"),s.onRefresh()):(s.$toast("订阅失败,请稍后重试!"),console.log("222222"))})).catch((function(t){s.$toast("网络异常，请稍后重试")}))},addNumBtn:function(){},addToChart:function(){var t=this;if(0!=this.skuList.storeNumber||0!=this.flashSaleData.skStoreBal){var e={ownerCode:this.$userInfo.OWNER_CODE,spuCode:this.lists.spuCode,skuNo:this.lists.skuList[0].skuNo,shopCode:this.lists.shopCode,skuCount:this.goodsNum,activitySpuId:this.activitySpuId,mark:1};Object(i["b"])(e).then((function(e){"0"==e.resultCode?(t.$toast("添加购物车成功"),t.getCartNum()):"20100"==e.resultCode&&"0"==e.data.result&&t.$toast("该商品添加购物车的数量已达上限")}))}else this.$toast("该商品正在努力补货中哦")},getCartNum:function(){var t=this,e={ownerCode:t.$userInfo.OWNER_CODE};Object(i["h"])(e).then((function(e){t.skuNum=e.data.skuTypeNum,p["a"].setStorage("skuTypeNum",t.skuNum)}))},getCount:function(){},turnToCart:function(){this.$router.push({path:"/shoppingCart"})},countDownFinish:function(){this.flashSaleDetail(),this.init()},moveInputIntoView:function(t){var e=this;this.isShowPlaceHolder=!0,this.$nextTick((function(){e.$refs.goodsPageScroll.scrollTop=e.$refs.changeTop.offsetTop-100}))},resetInputIntoView:function(t){this.isShowPlaceHolder=!1}},mounted:function(){},computed:Object(a["c"])({setFlashSaleSpuCode:function(t){return t.productPage.setFlashSaleSpuCode}}),watch:{setFlashSaleSpuCode:{handler:function(t,e){if(console.log("setFlashSaleSpuCodenewval"),console.log(t,e),-1!=t){if(-1!=t.indexOf(",")){var s=t.split(",");this.activitySpuId=s[0],this.spuCode=s[1],this.flashSaleDetail(),this.init()}this.$store.commit("setFlashSaleSpuCodeChange",{flashSaleSpuCode:-1})}}}},activated:function(){this.isShowPreview=!1;var t=this.$route.params.goodsUrl;t&&void 0!=t&&(this.productImgs=[t]),window.addEventListener("scroll",this.handleScroll),window.addEventListener("native.keyboardshow",this.moveInputIntoView),window.addEventListener("native.keyboardhide",this.resetInputIntoView),document.querySelector(".goodsDetail").addEventListener("touchmove",(function(t){document.activeElement&&document.activeElement.blur()}),{passive:!1}),this.$route.query.spuCode?(this.$refs.goodsPageScroll.scrollTop=this.scroll=0,this.spuCode=this.$route.query.spuCode,this.activitySpuId=this.$route.query.activitySpuId,this.init(),this.ifCollection(),this.getCartNum(),this.flashSaleDetail()):(this.init(),this.ifCollection(),this.getCartNum(),this.flashSaleDetail())},deactivated:function(){this.lists={},this.skuList={},this.goodsNum=1,this.productImgs=[],this.shopInfo={},this.titShow=1,this.show.activeTitle=!1,this.show.normalTitle=!0,this.show.beforeCollect=!0,this.show.afterCollect=!1,this.isShowTopBtn=!1},beforeRouteLeave:function(t,e,s){window.removeEventListener("scroll",this.handleScroll,!0),s()}}}}]);
//# sourceMappingURL=chunk-77ed86ee.5aa92e7a.js.map